{% extends "./base.html" %}
{% load static %}

{% block content %}

<div class="container py-5">
  <main>
    <div class="row g-4">
      <div class="col-lg-5">
        <div class="card border-0 shadow-sm">
          <div class="ratio ratio-1x1">
            <img class="img-fluid p-3 object-fit-contain" src="{{ product.image.url }}" alt="{{ product.title }}">
          </div>
        </div>
      </div>

      <div class="col-lg-7">
        <div class="ps-lg-4">
          <h1 class="h3 mb-2">{{ product.title }}</h1>
          <div class="d-flex align-items-center mb-3">
            <span class="badge bg-primary me-2">{{ product.brand }}</span>
            {% if product.in_stock %}
            <span class="badge bg-success">In Stock</span>
            {% else %}
            <span class="badge bg-secondary">Out of Stock</span>
            {% endif %}
          </div>

          <div class="mb-4">
            <h2 class="h4 text-primary">${{ product.price }}</h2>
          </div>

          <div class="mb-4">
            <h3 class="h5">Description</h3>
            <p class="text-muted">{{ product.description }}</p>
          </div>

          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
              <div class="row g-3 align-items-center">
                <div class="col-md-6">
                  <label for="select" class="form-label">Quantity</label>
                  <select id="select" class="form-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <button type="button" id="add-button" value="{{product.id}}" 
                    class="btn btn-primary w-100 py-2">
                    <i class="fas fa-cart-plus me-2"></i>Add to Cart
                  </button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </main>
</div>

<!-- ✅ Toast Notification -->
<div id="cart-toast" class="toast align-items-center text-white bg-success border-0 position-fixed bottom-0 end-0 m-4" role="alert" aria-live="assertive" aria-atomic="true" style="z-index: 9999; display: none;">
  <div class="d-flex">
    <div class="toast-body">
      Product added to cart!
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
</div>

<!-- ✅ JavaScript -->
<script>
  $(document).on('click', '#add-button', function(e){
    e.preventDefault();

    $.ajax({
      type: 'POST',
      url: '{% url "cart-add" %}',
      data: {
        product_id: $('#add-button').val(),
        product_quantity: $('#select option:selected').text(),
        csrfmiddlewaretoken: "{{csrf_token}}",
        action: 'post'
      },
      success: function(json){
        // Update cart quantity badge
        document.getElementById("cart-qty").textContent = json.qty;

        // Show toast
        const toastEl = document.getElementById('cart-toast');
        toastEl.style.display = 'block';
        const bsToast = new bootstrap.Toast(toastEl, { delay: 3000 });
        bsToast.show();
      },
      error: function(xhr, errmsg, err){
        alert("Something went wrong. Please try again.");
      }
    });
  });
</script>

{% endblock %}
